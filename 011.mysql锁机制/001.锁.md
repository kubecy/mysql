# 锁

## 1.概念

>锁是计算机协调多个进程或线程并发访问某一资源的机制。在数据库中，除传统的计算资源（CPU、RAM、I/O）的争用以外，数据也是一种供许多用户共享的资源。如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是影响数据库并发访问性能的一个重要因素。
>
>锁是计算机在执行多线程或线程时用于并发访问同一共享资源时的同步机制，MySQL中的锁是在服务器层或者存储引擎层实现的，保证了数据访问的一致性与有效性。

1. MySQL中的锁，按照锁的粒度分，分为以下三类：
   - 全局锁：对整个数据库实例加锁。
   - 表级锁：当前操作的整张表加锁，最常使用的 MyISAM 与 InnoDB 都支持表级锁定。
   - 行级锁：行级锁是粒度最低的锁，发生锁冲突的概率也最低、并发度最高。但是加锁慢、开销大，容易发生死锁现象。
2. InnoDB 存储引擎同时支持行级锁（row-level locking）和表级锁（table-level locking），默认情况下采用行级锁。
3. 表级锁适用于并发较低、以查询为主的应用，例如中小型的网站；MyISAM 和 MEMORY 存储引擎采用表级锁。
4. 行级锁适用于按索引条件高并发更新少量不同数据，同时又有并发查询的应用，例如 OLTP 系统；InnoDB 和 NDB 存储引擎实现了行级锁。

## 2.全局锁

1. 概念：
   - 全局锁是**对整个数据库实例加锁**，**加锁后整个实例就处于只读状态**，后续DML的写语句，DDL语句，已经更新操作的事务提交语句都会被阻塞。其典型的使用场景是做**全库的逻辑备份**，对所有的表进行锁定，从而获取一致性视图，保证数据的完整性。
2. 特点：
   - **锁定范围**：全局锁会锁定整个数据库实例，其他任何事务都无法对数据库执行读写操作，直到锁被释放。
   - **阻塞其他操作**：在全局锁定期间，所有对数据库的操作（包括读和写）都会被阻塞，从而保证在执行关键任务时数据的一致性。
   - **性能影响**：由于全局锁会阻塞所有操作，因此在使用时需要谨慎，以避免对系统性能造成严重影响。
3. 注意事项：
   - 使用全局锁时要小心，因为它会影响到数据库的可用性。尽量缩小锁的持有时间，以减少对其他操作的影响。
   - 在高并发环境下，使用全局锁可能会导致严重的性能瓶颈，建议根据实际情况评估其必要性。

~~~sql
-- 1、加全局锁
mysql> flush tables with read lock ;

-- 2、释放锁
mysql> unlock tables ;
~~~

## 3.表级锁

