#  InnoDB体系结构

## 1.内存结构（ In-Memory Structures）

![image-20241019150913466](./000.picture/image-20241019150913466.png)

### 1.1.[Buffer Pool](https://dev.mysql.com/doc/refman/8.0/en/innodb-buffer-pool.html)（缓冲池）

1. 概念：
   - 缓冲池是主内存中的一个区域，里面可以缓存磁盘上经常操作的真实数据，主要用来缓冲或缓存数据库服务的数据页和索引页。在执行增删改查操作时，先操作缓冲池中的数据(若缓冲池没有数据，则从磁盘加载并缓存)，然后再以一定频率刷新到磁盘，从而减少磁盘10，加快处理速度。
   - 缓冲池以Page页为单位，底层采用链表数据结构管理Page。根据状态，将Page分为三种类型:
     - free page:空闲page，未被使用。
     - clean page:被使用page，数据没有被修改过。
     - dirty page:脏页，被使用page，数据被修改过，也中数据与磁盘的数据产生了不一致。

#### 1.1.1.Buffer Pool内存空间管理

~~~sql
-- 1、Buffer Pool配置参数信息查看，buffer pool默认内存空间大小为128M，生产建议大小可以设置为物理内存总量的50%~80%
mysql> select @@innodb_buffer_pool_size;
+---------------------------+
| @@innodb_buffer_pool_size |
+---------------------------+
|                 134217728 |
+---------------------------+

-- 2、InnoDB 存储引擎当前仅使用一个缓冲池实例。
mysql> select @@innodb_buffer_pool_instances;
+--------------------------------+
| @@innodb_buffer_pool_instances |
+--------------------------------+
|                              1 |
+--------------------------------+

-- 3、Buffer Pool配置参数修改方法
# 配置信息临时调整，配置调整后，重新登录mysql数据库生效
mysql > set global innodb_buffer_pool_size=268435456;

# 配置信息永久调整，配置调整后，重新启动mysql数据库生效
root@mysql-db111 /root # vim /etc/my.cnf
[mysqld]
innodb_buffer_pool_size=256M



~~~

>:bell:优化。
>
>1. 产生不够用的情景有哪些？
>
>   - 设置太小。
>
>   - 大事务。
>
>   - ckpt触发不及时。
>
>   - IO比较慢。
>
>   - 查询语句优化的不好。
>
>2. 增加缓冲池实例的建议。
>
>   - 如果你的服务器有足够的内存，增加 `innodb_buffer_pool_instances` 的值可以帮助提高性能。通常推荐的做法是：
>
>     - 当 `innodb_buffer_pool_size` 大于 1GB 时，可以考虑设置多个实例。
>
>     - 缓冲池实例的数量可以设置为 `innodb_buffer_pool_size`（以MB为单位）除以 1GB。例如，若你的缓冲池为 8GB，建议设置为 8 个实例。
>
>       ~~~sql
>       innodb_buffer_pool_size = 8G      # 示例大小，根据实际情况调整
>       innodb_buffer_pool_instances = 8  # 根据实例数调整
>       ~~~
>
>       



### 1.2.[Change Buffer](https://dev.mysql.com/doc/refman/8.0/en/innodb-change-buffer.html)（更改缓冲区）



### 1.3.[Adaptive Hash Index](https://dev.mysql.com/doc/refman/8.0/en/innodb-adaptive-hash.html)（自适应哈希）



### 1.4.[Log Buffer](https://dev.mysql.com/doc/refman/8.0/en/innodb-redo-log-buffer.html)（日志缓冲区）

